<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ComparaciÃ³n con Otros - Saber TyT</title>
    
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/admin.css}">
</head>

<body>

    <div class="container-fluid">
        <div class="row">

            <!-- SIDEBAR ESTUDIANTE -->
            <nav class="col-md-2 sidebar p-3">
                <h4 class="mb-4">ğŸ“ Mi Panel</h4>
                <div class="nav flex-column">
                    <a th:href="@{/estudiante/dashboard}" class="nav-link">ğŸ“Š Dashboard</a>
                    <a th:href="@{/estudiante/identificacion}" class="nav-link">ğŸ†” IdentificaciÃ³n</a>
                    <a th:href="@{/estudiante/resultado-global}" class="nav-link">ğŸ¯ Resultado Global</a>
                    <a th:href="@{/estudiante/resultados-asignaturas}" class="nav-link">ğŸ“š Resultados por Asignatura</a>
                    <a th:href="@{/estudiante/beneficio}" class="nav-link">ğŸ Mi Beneficio</a>
                    <a th:href="@{/estudiante/comparacion}" class="nav-link active">ğŸ“ˆ ComparaciÃ³n</a>
                    <a th:href="@{/logout}" class="nav-link text-danger">ğŸšª Cerrar SesiÃ³n</a>
                </div>
            </nav>

            <!-- CONTENIDO PRINCIPAL -->
            <div class="col-md-10 p-4">

                <!-- BREADCRUMB -->
                <nav aria-label="breadcrumb" class="mb-3">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a th:href="@{/estudiante/dashboard}">Dashboard</a></li>
                        <li class="breadcrumb-item active">ComparaciÃ³n</li>
                    </ol>
                </nav>

                <!-- HEADER -->
                <h2>ğŸ“ˆ ComparaciÃ³n con Otros Estudiantes</h2>
                <p class="text-muted">AnÃ¡lisis de tu posiciÃ³n relativa con tu semestre</p>
                
                <!-- ALERTA PARA ESTUDIANTES ANULADOS -->
                <div th:if="${estudiante.estado == 'ANULADO'}" class="alert alert-danger mb-4">
                    <h4 class="alert-heading">ğŸš« Prueba Anulada</h4>
                    <p>Tu prueba fue anulada por el ICFES. No puedes ser comparado con otros estudiantes porque tus resultados no son vÃ¡lidos.</p>
                </div>

                <!-- MI POSICIÃ“N -->
                <div class="card mb-4 border-primary">
                    <div class="card-header bg-primary text-light">
                        <h5>ğŸ† Ranking</h5>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-md-3">
                                <h6>Mi PosiciÃ³n</h6>
                                <h1>#<span th:text="${posicion}">5</span></h1>
                                <small>de <span th:text="${totalEstudiantes}">34</span></small>
                            </div>
                            <div class="col-md-3">
                                <h6>Percentil</h6>
                                <h1><span th:text="${percentilTexto}">85.3</span>%</h1>
                                <small>Superaste al <span th:text="${percentilTexto}">85.3</span>%</small>
                            </div>
                            <div class="col-md-3">
                                <h6>Por Debajo de Ti</h6>
                                <h1 th:text="${menoresPuntajes}">29</h1>
                                <small>estudiantes</small>
                            </div>
                            <div class="col-md-3">
                                <h6>Por Encima de Ti</h6>
                                <h1 th:text="${mejoresPuntajes}">4</h1>
                                <small>estudiantes</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- DISTRIBUCIÃ“N VISUAL -->
                <div class="card mb-4">
                    <div class="card-header bg-success text-light">
                        <h5>ğŸ“Š DistribuciÃ³n Visual</h5>
                    </div>
                    <div class="card-body">
                        <div class="progress mb-3">
                            <div class="progress-bar bg-danger" th:style="'width: ' + (${mejoresPuntajes} * 100.0 / ${totalEstudiantes}) + '%;'">
                                <small th:text="${mejoresPuntajes}">4</small>
                            </div>
                            <div class="progress-bar bg-secondary" style="width: 3%;">
                                <small>TÃº</small>
                            </div>
                            <div class="progress-bar bg-info" th:style="'width: ' + (${menoresPuntajes} * 100.0 / ${totalEstudiantes}) + '%;'">
                                <small th:text="${menoresPuntajes}">29</small>
                            </div>
                        </div>
                        <p class="lead">EstÃ¡s en el <strong>percentil <span th:text="${percentilTexto}">85.3</span>%</strong></p>
                    </div>
                </div>

                <!-- COMPARACIÃ“N DE PUNTAJES -->
                <div class="card mb-4">
                    <div class="card-header bg-warning text-dark">
                        <h5>ğŸ“ˆ ComparaciÃ³n de Puntajes</h5>
                    </div>
                    <div class="card-body">
                        <table class="table table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th>Referencia</th>
                                    <th class="text-center">Puntaje</th>
                                    <th class="text-center">Diferencia</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="table-success">
                                    <td>ğŸ† Puntaje MÃ¡ximo</td>
                                    <td class="text-center"><span class="badge bg-success" th:text="${maximo}">200</span></td>
                                    <td class="text-center"><span class="badge bg-danger" th:text="'-' + ${#numbers.formatDecimal(maximo - estudiante.puntajeSaberPro, 0, 0)}">-5</span></td>
                                </tr>
                                <tr class="table-primary">
                                    <td>ğŸ¯ MI PUNTAJE</td>
                                    <td class="text-center"><span class="badge bg-primary" th:text="${estudiante.puntajeSaberPro}">195</span></td>
                                    <td class="text-center"><span class="badge bg-info">REFERENCIA</span></td>
                                </tr>
                                <tr class="table-danger">
                                    <td>ğŸ“‰ Puntaje MÃ­nimo</td>
                                    <td class="text-center"><span class="badge bg-danger" th:text="${minimo}">96</span></td>
                                    <td class="text-center"><span class="badge bg-success" th:text="'+' + ${#numbers.formatDecimal(estudiante.puntajeSaberPro - minimo, 0, 0)}">+99</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- GRÃFICO COMPARATIVO -->
                <div class="card mb-4">
                    <div class="card-header bg-info text-dark">
                        <h5>ğŸ“Š GrÃ¡fico Comparativo de Puntajes</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="chartComparativo" style="max-height: 350px;"></canvas>
                    </div>
                </div>

                <!-- INTERPRETACIÃ“N DEL RESULTADO -->
                <div class="card mb-4">
                    <div class="card-header bg-dark text-light">
                        <h5>ğŸ’¡ InterpretaciÃ³n de tu PosiciÃ³n</h5>
                    </div>
                    <div class="card-body">
                        <div th:if="${percentil >= 90}" class="alert alert-success">
                            <h5>ğŸŒŸ Â¡Excelente PosiciÃ³n!</h5>
                            <ul>
                                <li>Dominio sobresaliente de las competencias evaluadas</li>
                                <li>PreparaciÃ³n acadÃ©mica superior al promedio</li>
                                <li>Alto nivel de desarrollo en habilidades crÃ­ticas</li>
                            </ul>
                        </div>
                        <div th:if="${percentil < 90}" class="alert alert-warning">
                            <h5>ğŸ“Š PosiciÃ³n Media</h5>
                            <ul>
                                <li>DesempeÃ±o satisfactorio en las competencias</li>
                                <li>Hay espacio para mejorar</li>
                                <li>PosiciÃ³n favorable dentro del grupo</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- BOTÃ“N REGRESAR -->
                <div class="text-center">
                    <a th:href="@{/estudiante/dashboard}" class="btn btn-primary btn-lg">â† Volver</a>
                </div>
            </div>

        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script th:inline="javascript">
        const ctx = document.getElementById('chartComparativo');
        
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Puntaje MÃ­nimo', 'Promedio', 'Tu Puntaje', 'Puntaje MÃ¡ximo'],
                datasets: [{
                    label: 'Puntajes',
                    data: [
                        [[${minimo}]],
                        [[${promedioInt}]],
                        [[${estudiante.puntajeSaberPro}]],
                        [[${maximo}]]
                    ],
                    backgroundColor: ['#E0BBE4', '#FFD1DC', '#B4D7E8', '#C1E1C1'],
                    borderColor: ['#E0BBE4', '#FFD1DC', '#B4D7E8', '#C1E1C1'],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 200,
                        ticks: { stepSize: 40 }
                    },
                    x: {
                        ticks: { font: { size: 12 } }
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: 'ComparaciÃ³n de Puntajes - Escala 0-200',
                        font: { size: 16 }
                    },
                    legend: { display: false }
                }
            }
        });
    </script>

</body>
</html>
